<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="typedValue.css">
	<style type="text/css"> <!-- .VERSION:before{content:"0.97.1";} --> </style>
	<style type="text/css"> <!-- .DATE:before{content:"2025.3.25";} --> </style>
	<title>Paraphrase ドキュメント ver. 0.97.1</title>
</head>
<body>
<div id=main>
<h1>Paraphrase における文字列データの記述方法について</h1>
<div id=author><span class="DATE"></span> 飯倉宏治</div>
<p>
Paraphrase では多くのプログラミング言語と同様に、文字列を値として使用可能です。
文字列データの記述は、これまた多くのプログラミング言語と同様に
ダブルクォート（"）またはシングルクォート（'）で括ります。 <br>
<br>
	<tt>
	&nbsp;&nbsp;&nbsp;&nbsp; "文字列" <br>
	&nbsp;&nbsp;&nbsp;&nbsp; '文字列'
	</tt>
</p>

<p>
文字列データの開始を示すクォートは同じ種類でなければなりません。
ダブルクォートで文字列データの記述を開始した場合は、
その文字列データはダブルクォートにて終了します。
</p>
<p>
このような規則があるため、ダブルクォートを用いると、
次のようにシングルクォートを含んだ文字列データの記述が可能となります。<br>
<br>
	<tt>
	&nbsp;&nbsp;&nbsp;&nbsp; "ASCII コード 0x41 は文字列 'A' を示します。" <br>
	</tt>
<br>
ダブルクォートにて括られた文字列では、
シングルクォートに特別な機能（意味）は存在しません。
なので、文字列中に必ずしも偶数個存在する必要はありません
（奇数個でも何ら問題は生じません）。
</p>

<p>
逆に、シングルクォートで括られる場合では、
文字列中のダブルクォートは単なる文字として取り扱われます。<br>
<br>
	<tt>
	&nbsp;&nbsp;&nbsp;&nbsp; 'ASCII コード 0x41 は文字列 "A" を示します。' <br>
	</tt>
<br>
先程の例と同様、この例では文字列中のダブルクォートの個数は偶数でも奇数でも構いません。
</p>

<p>
次のセクションで説明しますが、
ダブルクォートで括った場合とシングルクォートで括った場合では、
特殊文字の表現能力が異なります。
改行文字などの特殊文字が文字列データ中に存在しない場合は、
シングルクォートで括ると良いでしょう。
</p>

<h2>ダブルクォートとシングルクォートの使い分け</h2>
ダブルクォートとシングルクォートの使い分けですが、
特殊文字を示すエスケープシーケンスの取り扱いが異なります。
ダブルクォートで括られる文字列データを括った場合、
バックスラッシュをエスケープ文字として用いる以下の特殊文字が使用可能です：<br>
<br>
<b>ダブルクォートで括られた文字列中で使用可能な特殊文字</b>
<div align=center>
<table id=fmtList>
	<tr>
		<td width="180em"><tt>\n</tt></td>
		<td>改行</td>
	</tr>
	<tr>
		<td><tt>\r</tt></td>
		<td>復帰</td>
	</tr>
	<tr>
		<td><tt>\t</tt></td>
		<td>タブ</td>
	</td>
	<tr>
		<td><tt>\"</tt></td>
		<td>ダブルクォート</td>
	</tr>
	<tr>
		<td><tt>\'</tt></td>
		<td>シングルクォート</td>
	</tr>
	<tr>
		<td><tt>\\</tt></td>
		<td>バックスラッシュ</td>
	</tr>
</table>
</div>

<p>
一方、シングルクォートにて括られる文字列中では、
上記の殆どの特殊文字は使用できません。
それは、シングルクォートは括られた
文字列そのものを表す生文字列（raw 文字列）のために用いられるからです。
</p>

<h2>シングルクォートによる生文字列（raw 文字列）</h2>
ダブルクォートで括られた文字列中では、
バックスラッシュが各種の特殊文字のためのエスケープ文字として使用されます。
しかし、この機能により文字列データの記述が煩雑になる場合があります。
例えば、正規表現のパターンを記述する場合などです。
</p>
<p>
正規表現では数値を示すために<tt>\d</tt>と表記します。
ある文字列から数字を 3 つ取り出すための正規表現は
<tt>\d\d\d</tt>となります。
ダブルクォートを使った場合、バックスラッシュ自体を表すため、
バックスラッシュによるエスケープが必要となっています。
一方、シングルクォートを用いる場合は、
原則としてバックスラッシュはエスケープ文字ではなく、
単なる文字として解釈されます。
なので、ダブルクォートとシングルクォートを用いて、
正規表現 <tt>\d\d\d</tt> を表すと次のようになります：<br>
<br>
	<tt>
	&nbsp;&nbsp;&nbsp;&nbsp; '\d\d\d' <br>
	&nbsp;&nbsp;&nbsp;&nbsp; "\\d\\d\\d" <br>
	</tt>
<br>
今回は簡単な例ですので、3 文字しか違いはありませんが、
複雑な正規表現の場合、この差は大きくなります。
</p>

<p>
正規表現等におけるバックスラッシュの増大を避けるため、
いくつかのプログラミング言語では、
記述された文字列データをそのままの文字列として取り扱う
生文字列（raw 文字列）という機能が提供されています。
Paraphrase ではシングルクォートで括られる文字列が、
この生文字列となります。
</p>

<p>
以下は <a href="https://github.com/kanaka/mal/blob/master/process/guide.md#step-1-read-and-print"
>Make A Lisp</a> におけるトークン切り出し部分で使われている正規表現の例です。
シングルクォートで括る場合は、<br>
<br>
	<tt>
	'[\s,]*(~@|[\[\]{}()\'`~^@]|"(?:\\.|[^\\"])*"?|;.*|[^\s\[\]{}(\'"`,;)]*)' <br>
	</tt>
<br>
となりますが、これをダブルクォートで括ると<br>
<br>
	<tt>
		"[\\s,]*(~@|[\\[\\]{}()'`~^@]|\"(?:\\\\.|[^\\\\\"])*\"?|;.*|[^\\s\\[\\]{}('\"`,;)]*)" <br>
	</tt>
<br>
となり、バックスラッシュが増大しています。
一方、シングルクォートを用いた raw 文字列の場合、
元の正規表現の表記と異なる部分はシングルクォートを表すための
エスケープ文字の追加だけとなり、
よりオリジナルの正規表現に近い表記となっています。
</p>

<p>
このように、シングルクォートで括られた文字列中では、
バックスラッシュは基本的にはエスケープ文字としての機能を有しません。
そのため、バックスラッシュを多用する正規表現などでも、
バックスラッシュ文字の増大をある程度抑制することが可能となります。
</p>

<p>
以下に、シングルクォートで括られた文字列データ中にて、
バックスラッシュがエスケープ文字として機能するものを示します: <br>
<br>
<b>シングルクォートで括られた文字列中で使用可能な特殊文字</b>
<div align=center>
<table id=fmtList>
	<tr>
		<td width="50em"><tt>\'</tt></td>
		<td>シングルクォート</td>
	</tr>
	<tr>
		<td><tt>\0</tt></td>
		<td>空文字</td>
	</tr>
</table>
</div>

<p>
多くの場合、特に意識することなくそのまま表現できるかと思いますが、
文字列データの最後の文字がバックスラッシュの場合は少し注意が必要となります。
それは、<tt>'〜\'</tt>という文字列では、最終文字列のバックスラッシュが
その直後のシングルクォートのためのエスケープ文字として
解釈されてしまうからです。
</p>
<p>
このような場合には、ダミーの空文字<tt>\0</tt>を文字列の最後に置いて下さい。
例えば、<u><tt>〜\</tt></u>という文字列データを生成する場合には<br>
<br>
	<tt>
	&nbsp;&nbsp;&nbsp;&nbsp; '〜\\0' <br>
	</tt>
<br>
として下さい。
</p>

<h3>備考：空文字について</h3>
<p>
空文字は何もデータを生成しませんので、
<tt>'abc'</tt> と <tt>'\0a\0b\0c\0\0'</tt> は
同じ文字列データ <u><tt>abc</tt></u> を生成します。
また、空の文字列 <tt>''</tt> は <tt>'\0'</tt> などとも記述できます
（が、使い道はあまり無いかと思います）。
</p>

</div>
</body>
</html>

